# 飞书文档批量导出教程

## 一、准备工作

### 1.1 创建飞书自建应用

1. 访问飞书开发者后台：https://open.feishu.cn/
2. 点击「开发者后台」→「创建企业自建应用」
3. 填写应用名称和描述（随意填写即可）
4. 点击「创建」

### 1.2 配置应用权限

1. 进入应用详情页，点击左侧「权限管理」
2. 点击「批量导入/导出权限」按钮
3. 选择「导入权限」，粘贴以下内容：

```json
{
  "scopes": {
    "tenant": [
      "bitable:app",
      "bitable:app:readonly",
      "docs:doc:readonly",
      "docs:document:export",
      "docs:document.media:download",
      "sheets:spreadsheet",
      "sheets:spreadsheet:readonly",
      "wiki:wiki",
      "wiki:wiki:readonly",
      "wiki:space:read",
      "wiki:node:read",
      "docx:document",
      "docx:document:readonly",
      "space:document:retrieve"
    ],
    "user": []
  }
}
```

4. 点击确认，开通所有权限

### 1.3 添加机器人能力

1. 点击左侧「添加应用能力」
2. 找到「机器人」卡片，点击「添加」

### 1.4 发布应用版本

1. 点击左侧「版本管理与发布」
2. 点击「创建版本」
3. 填写版本号（如：1.0.0）和更新说明
4. 点击「申请线上发布」
5. 等待企业管理员审核通过

> 💡 如果只是为了测试，可以选择「测试企业和人员」，创建测试企业进行测试

### 1.5 获取应用凭证

1. 点击左侧「凭证与基础信息」
2. 复制并保存 `App ID` 和 `App Secret`

---

## 二、为机器人添加知识库权限

### 2.1 创建群组并添加机器人

1. 打开飞书客户端
2. 创建一个新的群组（或使用已有群组）
3. 点击群组设置 →「群机器人」→「添加机器人」
4. 选择您创建的应用作为群机器人

### 2.2 设置知识库管理员权限

1. 打开飞书知识库
2. 点击「知识空间设置」（需要是知识库管理员才能看到）
3. 点击「成员管理」→「添加管理员」
4. 选择刚刚创建的群组

---

## 三、执行导出命令

### 3.1 打开命令行

在当前目录打开 PowerShell 或命令提示符

### 3.2 执行导出命令

#### 基本导出（导出为docx格式）
```powershell
.\feishu-doc-export.exe --appId=您的AppId --appSecret=您的AppSecret --exportPath=D:\导出目录
```

#### 导出为Markdown格式
```powershell
.\feishu-doc-export.exe --appId=您的AppId --appSecret=您的AppSecret --saveType=md --exportPath=D:\导出目录
```

#### 导出为PDF格式
```powershell
.\feishu-doc-export.exe --appId=您的AppId --appSecret=您的AppSecret --saveType=pdf --exportPath=D:\导出目录
```

#### 指定知识库导出
```powershell
.\feishu-doc-export.exe --appId=您的AppId --appSecret=您的AppSecret --spaceId=知识库ID --exportPath=D:\导出目录
```

#### 导出个人空间文档
```powershell
.\feishu-doc-export.exe --appId=您的AppId --appSecret=您的AppSecret --type=cloudDoc --folderToken=文件夹Token --exportPath=D:\导出目录
```

### 3.3 参数说明

| 参数 | 说明 | 是否必填 |
|------|------|---------|
| `--appId` | 飞书自建应用的AppId | 必填 |
| `--appSecret` | 飞书自建应用的AppSecret | 必填 |
| `--exportPath` | 文档导出的目录位置 | 必填 |
| `--spaceId` | 飞书导出的知识库ID | 可选 |
| `--type` | 导出类型：wiki（知识库）或 cloudDoc（个人空间） | 可选，默认wiki |
| `--saveType` | 导出格式：docx、md、pdf | 可选，默认docx |
| `--folderToken` | 个人空间文件夹Token（type=cloudDoc时必填） | 可选 |
| `--quit` | 程序运行结束后自动退出 | 可选 |

---

## 四、获取知识库ID和文件夹Token

### 4.1 获取知识库ID

1. 打开飞书知识库
2. 点击目标知识库
3. 查看浏览器地址栏，URL格式为：
   ```
   https://xxx.feishu.cn/wiki/space/xxxxxxxxxx
   ```
4. 其中 `xxxxxxxxxx` 就是知识库ID

### 4.2 获取文件夹Token（个人空间）

1. 打开飞书云文档
2. 进入目标文件夹
3. 查看浏览器地址栏，URL格式为：
   ```
   https://xxx.feishu.cn/drive/folder/xxxxxxxxxx
   ```
4. 其中 `xxxxxxxxxx` 就是文件夹Token

---

## 五、常见问题

### Q1: 提示权限不足怎么办？
- 确认已在飞书开发者后台开通所有必要权限
- 确认已创建版本并发布上线
- 确认机器人已添加为知识库管理员

### Q2: 导出的Markdown格式丢失？
- 这是已知问题，飞书API导出docx时就会丢失部分格式
- 建议使用docx格式导出

### Q3: 导出速度慢怎么办？
- docx格式导出最快
- pdf格式最慢（因为图片需要内嵌）
- 网络环境也会影响导出速度

### Q4: 如何导出大量文档？
- 程序支持后台挂机运行
- 700多个文档约需25分钟
- 建议在网络稳定的环境下操作

---

## 六、注意事项

1. 导出的文档目录结构与飞书知识库保持一致
2. 文档中引用的其他文档会以相对路径引用
3. 导出过程中请勿关闭命令行窗口
4. 建议定期备份导出的文档
